//
//  MTTabBarView.m
//  MTGJ
//
//  Created by zhouxz on 14/11/17.
//  Copyright (c) 2014年 MallTang. All rights reserved.
//

#import "MTTabBarView.h"
#import <QuartzCore/QuartzCore.h>
#import "UIView+FrameEx.h"

#define MT_TAB_BAR_BUTTON_TAG_BASE 100

@interface MTTabBarView ()
@property (nonatomic ,strong) UILabel *barge;
@end

@implementation MTTabBarView

- (id)initWithFrame:(CGRect)frame {
    if (self = [super initWithFrame:frame]) {
        self.backgroundColor = [UIColor whiteColor];
        UIImageView *xian = [[UIImageView alloc]initWithFrame:CGRectMake(0, 1, self.width,0.5)];
        xian.backgroundColor = [UIColor lightGrayColor];
        [self addSubview:xian];
//        @[ @"All", @"T2", @"bianlidian", @"T3"
        self.barge = [[UILabel alloc]initWithFrame:CGRectMake(([UIScreen mainScreen].bounds.size.width-256-40)/3*2+64*2+60, 5, 20,20)];
        self.barge.backgroundColor = [UIColor redColor];
        self.barge.layer.cornerRadius = 10;
        self.barge.layer.masksToBounds = YES;
        self.barge.textColor = [UIColor whiteColor];
        self.barge.font = [UIFont systemFontOfSize:12.0f];
        self.barge.textAlignment = NSTextAlignmentCenter;
        [self setbarge:0];
        [self addSubview:self.barge];
     
        CGRect rect0 = CGRectMake(20, 10, 64, 44);
        [self setButtonWithTitle:@"菜 单"
                     normalImage:[UIImage imageNamed:@"ic_home"]
                   selectedImage:[UIImage imageNamed:@"ic_home_on"]
                           frame:rect0
                           index:0];
     
        CGRect rect1 = CGRectMake(([UIScreen mainScreen].bounds.size.width-256-40)/3+64+20, 10, 64, 44);
        [self setButtonWithTitle:@"订 单"
                     normalImage:[UIImage imageNamed:@"ic_order"]
                   selectedImage:[UIImage imageNamed:@"ic_order_on"]
                           frame:rect1
                           index:1];
        CGRect rect2 = CGRectMake(([UIScreen mainScreen].bounds.size.width-256-40)/3*2+64*2+20, 10, 64, 44);
        [self setButtonWithTitle:@"购物车"
                     normalImage:[UIImage imageNamed:@"ic_cart"]
                   selectedImage:[UIImage imageNamed:@"ic_cart_on"]
                           frame:rect2
                           index:2];
        CGRect rect3 = CGRectMake(([UIScreen mainScreen].bounds.size.width-256-40)/3*3+64*3+20, 10, 64, 44);

        [self setButtonWithTitle:@"我 的"
                     normalImage:[UIImage imageNamed:@"ic_mine"]
                   selectedImage:[UIImage imageNamed:@"ic_mine_on"]
                           frame:rect3
                           index:3];

    }
    return self;
}
- (void)setbarge:(NSInteger)index;

{
    if (index ==0) {
        self.barge.hidden = YES;
    }else{
        self.barge.hidden = NO;

        self.barge.text = [NSString stringWithFormat:@"%ld",index];
    }
}
- (void)setButtonWithTitle:(NSString *)title normalImage:(UIImage *)normalImage selectedImage:(UIImage *)selectedImage frame:(CGRect)frame index:(NSUInteger)index {
    
    UIButton *item = [UIButton buttonWithType:UIButtonTypeCustom];
    item.frame = frame;
    item.tag = MT_TAB_BAR_BUTTON_TAG_BASE+index;
    [item addTarget:self action:@selector(onHitButton:) forControlEvents:UIControlEventTouchDown];
    [item setTitleColor:[UIColor grayColor] forState:UIControlStateNormal];
    [item setTitle:title forState:UIControlStateNormal];
    [item setTitleColor:[UIColor redColor] forState:UIControlStateSelected];
    item.titleLabel.font = [UIFont boldSystemFontOfSize:10];
    [item setImage:normalImage forState:UIControlStateNormal];
    [item setImage:selectedImage forState:UIControlStateSelected];
    if (title) {
        [item setImageEdgeInsets:UIEdgeInsetsMake(-16, 12, 10, -8)];
        [item setTitleEdgeInsets:UIEdgeInsetsMake(6, -19, -6, 8)];
    }
    [self addSubview:item];
}

- (void)onHitButton:(UIButton *)button {
    [self setSelectedStateForButtonAtIndex:button.tag-MT_TAB_BAR_BUTTON_TAG_BASE];
    
    if (self.delegate && [self.delegate respondsToSelector:@selector(mtTabbar:didSelectItemAtIndex:)]) {
        [self.delegate mtTabbar:self didSelectItemAtIndex:button.tag-MT_TAB_BAR_BUTTON_TAG_BASE];
    }
}

- (void)setSelectedStateForButtonAtIndex:(NSInteger)index {
    UIButton *button = (UIButton *)[self viewWithTag:MT_TAB_BAR_BUTTON_TAG_BASE+index];
    
    if (button.isSelected) {
        return;
    }
    
    for (UIView *view in [self subviews]) {
        if ([view isKindOfClass:[UIButton class]]) {
            [(UIButton *)view setSelected:NO];
        }
    }
    
    [button setSelected:YES];
}

@end
